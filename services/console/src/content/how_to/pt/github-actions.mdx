---
title: "A√ß√µes do GitHub"
description: "Use o Bencher nas A√ß√µes do GitHub para benchmarking cont√≠nuo em pull requests"
heading: "Como usar o Bencher nas A√ß√µes do GitHub"
sortOrder: 3
---

import GitHubActions1 from "../../../chunks/how_to/github-actions.1.mdx";
import GitHubActions2 from "../../../chunks/how_to/github-actions.2.mdx";
import GitHubActions4 from "../../../chunks/how_to/github-actions.4.mdx";
import GitHubActions5 from "../../../chunks/how_to/github-actions.5.mdx";
import GitHubActions6 from "../../../chunks/how_to/github-actions.6.mdx";

<GitHubActions1 />

1. Crie um arquivo de `workflow` das A√ß√µes do GitHub. (ex: `.github/workflows/benchmark.yml`)
2. Execute em eventos de `push` para a branch `main`. Veja a [documenta√ß√£o `on` das A√ß√µes do GitHub](https://docs.github.com/pt/actions/using-workflows/workflow-syntax-for-github-actions#on) para uma vis√£o geral completa. Veja tamb√©m [Pull Requests](#pull-requests) abaixo.
3. Crie uma `job` das A√ß√µes do GitHub. (ex: `benchmark_with_bencher`)
4. O Projeto j√° deve existir. Definir a flag `--project` ou a vari√°vel de ambiente `BENCHER_PROJECT` para o slug do Projeto ou UUID (ex: `BENCHER_PROJECT: save-walter-white`).
5. O token API j√° deve existir. Adicione `BENCHER_API_TOKEN` como segredo do **Reposit√≥rio** (ex: `Reposit√≥rio -> Configura√ß√µes -> Segredos e vari√°veis -> A√ß√µes -> Novo segredo do reposit√≥rio`). Defina a flag `--token` ou a vari√°vel de ambiente `BENCHER_API_TOKEN` para o token API. (ex: `BENCHER_API_TOKEN: ${{ secrets.BENCHER_API_TOKEN }}`)
6. Opcional: Definir a flag `--testbed` ou a vari√°vel de ambiente `BENCHER_TESTBED` para o slug do Testbed ou UUID. (ex: `BENCHER_TESTBED: ubuntu-latest`) O Testbed **deve** j√° existir. Se isso n√£o for definido, ent√£o o Testbed `localhost` ser√° usado.
7. Opcional: Defina a flag `--adapter` ou a vari√°vel de ambiente `BENCHER_ADAPTER` para o nome do adaptador desejado. (ex: `BENCHER_ADAPTER: json`) Se isso n√£o for definido, ent√£o o Adaptador `magic` ser√° usado. Veja [adaptadores de harness de benchmark](/docs/pt/explanation/adapters) para uma vis√£o geral completa.
8. Fa√ßa o checkout do seu c√≥digo-fonte. (ex: `uses: actions/checkout@v3`)
9.  Instale o CLI Bencher usando a [A√ß√£o do GitHub](https://github.com/marketplace/actions/bencher-cli). (ex: `uses: bencherdev/bencher@main`)
10. [Monitore seus benchmarks](/docs/pt/how-to/track-benchmarks) com o subcomando CLI <code><a href="/docs/pt/explanation/bencher-run">bencher run</a></code>:
    1.  Opcional: Defina a flag `--branch` ou a vari√°vel de ambiente `BENCHER_BRANCH` para o slug da Branch ou UUID. (ex: `--branch main`) A Branch **deve** j√° existir. Se isso n√£o for definido, ent√£o a Branch `main` ser√° usada.
    2.  Definir o comando para falhar se um Alerta for gerado. (ex: `--err`) Para que um Alerta seja gerado, um [Limite](/docs/pt/explanation/thresholds) j√° deve existir.
    3.  Execute seus benchmarks e gere um Relat√≥rio a partir dos resultados. (ex: `"bencher mock"`)

<br/>

## Pull Requests

Para detectar regress√£o de desempenho em Pull Requests, voc√™ precisar√° executar seus benchmarks em PRs.
Se voc√™ espera ter PRs apenas de branches dentro do **mesmo** reposit√≥rio, ent√£o voc√™ pode simplesmente modificar o exemplo acima para tamb√©m executar `on` eventos de `pull_request`.

> ‚ö†Ô∏è Esta solu√ß√£o s√≥ funciona se todos os PRs s√£o do **mesmo** reposit√≥rio!
> Veja [Pull Requests de Forks](#pull-requests-de-forks) abaixo.

<GitHubActions2 />

1. Execute em eventos de `push` para a branch `main` e em eventos de `pull_request`. √â importante limitar a execu√ß√£o em `push` **apenas** para as branches selecionadas (ex: `main`) para evitar que pushes para branches de PR sejam executados duas vezes!
2. Em vez de sempre usar a branch `main`, use as [vari√°veis de ambiente padr√£o das A√ß√µes do GitHub](https://docs.github.com/pt/actions/learn-github-actions/variables#default-environment-variables) para:
        1. Use os dados da branch atual se j√° existirem. (ex: `--if-branch "$GITHUB_REF_NAME"`)
        2. Crie um clone dos dados e limites da branch de destino do PR se j√° existirem. (ex: `--else-if-branch "$GITHUB_BASE_REF"`)
        3. Caso contr√°rio, crie um clone dos dados e limites da branch `main`. (ex: `--else-if-branch main`)
        4. Existem v√°rias op√ß√µes para definir a branch do projeto. Veja [sele√ß√£o de branch](/docs/pt/explanation/branch-selection) para uma vis√£o geral completa.
3. Defina o token de autentica√ß√£o da API do GitHub. (ex: `--github-actions ${{ secrets.GITHUB_TOKEN }}`) Quando essa op√ß√£o √© definida como parte de um pull request, ent√£o os resultados ser√£o adicionados ao pull request como um coment√°rio. Isso usa [a vari√°vel de ambiente `GITHUB_TOKEN` das A√ß√µes do GitHub](https://docs.github.com/pt/actions/security-guides/automatic-token-authentication).
4. Veja a documenta√ß√£o do [bencher run](/docs/pt/explanation/bencher-run) para uma vis√£o geral completa de todas as maneiras de configurar o coment√°rio do pull request com as flags `--ci-*`.

## Pull Requests de Forks

Se voc√™ planeja aceitar pull requests de forks, como √© frequentemente o caso em projetos de c√≥digo aberto p√∫blico,
ent√£o voc√™ precisar√° lidar com as coisas de maneira um pouco diferente.
Por motivos de seguran√ßa, segredos como seu `BENCHER_API_TOKEN` e o `GITHUB_TOKEN` n√£o est√£o dispon√≠veis nas A√ß√µes do GitHub para PRs de forks.
Ou seja, se um colaborador externo abrir um PR a partir de um fork, o exemplo acima n√£o funcionar√°.
Existem tr√™s op√ß√µes para PRs de forks:

<ul>
  <li>[Benchmark PR Fork da Branch Alvo](#benchmark-pr-fork-da-branch-alvo)</li>
  <li>[Benchmark PR Fork da Branch Alvo com Revisores Obrigat√≥rios](#benchmark-pr-fork-da-branch-alvo-com-revisores-obrigatorios)</li>
  <li>[Benchmark PR Fork e Upload da Branch Padr√£o](#benchmark-pr-fork-e-upload-da-branch-padrao)</li>
</ul>

### Benchmark PR Fork da Branch Alvo

<GitHubActions4 />

1. Execute em eventos de `push` para a branch `main` e [em eventos de `pull_request_target`](https://docs.github.com/pt/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
2. Crie uma `job` que s√≥ √© executada para eventos de `push` para a branch `main`. Al√©m da condi√ß√£o `if`, esse trabalho √© quase id√™ntico ao exemplo original acima.
3. Crie uma `job` que s√≥ √© executada para eventos de `pull_request_target`.
   1. Fa√ßa o checkout da branch do pull request.
   2. Passe todos os segredos diretamente. Use `--token ${{ secrets.BENCHER_API_TOKEN }}` em vez da vari√°vel de ambiente `BENCHER_API_TOKEN`.
   3. Execute e monitore seus benchmarks de pull request com `bencher run`.

Esta configura√ß√£o funciona porque `pull_request_target` √© executado no contexto da branch alvo do pull request,
onde seus segredos como `BENCHER_API_TOKEN` e `GITHUB_TOKEN` est√£o dispon√≠veis.
Portanto, esse workflow s√≥ ser√° executado se existir na branch _alvo_.
Evite definir quaisquer segredos como vari√°veis de ambiente, como `BENCHER_API_TOKEN`.
Em vez disso, passe explicitamente o token da API para `bencher run`. (ex: `--token ${{ secrets.BENCHER_API_TOKEN }}`)
Veja este [artigo do GitHub Security Lab](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)
e [este post de blog](https://nathandavison.com/blog/github-actions-and-the-threat-of-malicious-pull-requests)
sobre a preven√ß√£o de solicita√ß√µes pwn para uma vis√£o geral completa.

### Benchmark PR Fork da Branch Alvo com Revisores Obrigat√≥rios

<GitHubActions5 />

Esta configura√ß√£o √© exatamente a mesma que [Benchmark PR Fork da Branch Alvo](#benchmark-pr-fork-da-branch-alvo)
com a exig√™ncia adicional de aprova√ß√£o de um Revisor Necess√°rio antes de cada execu√ß√£o do fork do pull request.
Pull requests do mesmo reposit√≥rio n√£o requerem aprova√ß√£o.
Para configurar isso, voc√™ precisa [criar dois Ambientes de A√ß√£o do GitHub](https://docs.github.com/pt/actions/deployment/targeting-different-environments/using-environments-for-deployment#using-an-environment)
(ex: `Repo -> Configura√ß√µes -> Ambientes -> Novo ambiente`).
O ambiente `interno` n√£o deve ter `Regras de prote√ß√£o de implanta√ß√£o`.
No entanto, o ambiente `externo` deve ter `Revisores necess√°rios` definidos para aqueles confi√°veis para revisar PRs de fork antes do benchmarking.

### Benchmark PR Fork e Upload da Branch Padr√£o

<GitHubActions6 />

1. Crie um arquivo de workflow `Run and Cache Benchmarks`.
2. Execute seus benchmarks em eventos de `pull_request`.
3. Salve os resultados dos benchmarks em um arquivo e fa√ßa o upload deles como um artefato.
4. Fa√ßa o upload do evento `pull_request` como um artefato.
5. Crie um segundo arquivo de workflow, `Track Benchmarks`.
6. Encadeie `Track Benchmarks` a `Run and Cache Benchmarks` com [o evento `workflow_run`](https://docs.github.com/pt/actions/using-workflows/events-that-trigger-workflows#workflow_run).
7. Extraia os dados necess√°rios do evento `pull_request` armazenado em cache.
8. Monitore os resultados do benchmark armazenado em cache com `bencher run`.
9. Crie um terceiro arquivo de workflow e use o exemplo inicial acima para executar em eventos de `push` para a branch `main`.

Esta configura√ß√£o funciona porque `workflow_run` √© executado no contexto da branch padr√£o do reposit√≥rio,
onde seus segredos como `BENCHER_API_TOKEN` e `GITHUB_TOKEN` est√£o dispon√≠veis.
Portanto, esses workflows s√≥ ser√£o executados se existirem na branch _padr√£o_.
Veja [usando dados do workflow que desencadeou](https://docs.github.com/pt/actions/using-workflows/events-that-trigger-workflows#using-data-from-the-triggering-workflow) para uma vis√£o geral completa.
O n√∫mero do pull request, a branch de origem e a branch base usada no workflow inicial devem ser passados explicitamente, pois eles n√£o est√£o dispon√≠veis dentro do `workflow_run`.

<br/>
<br/>

> üê∞ Parab√©ns! Voc√™ aprendeu como usar o Bencher nas A√ß√µes do GitHub! üéâ

<br/>

<h2><a href="/docs/pt/explanation/benchmarking">Continue: Vis√£o Geral do Benchmarking ‚û°</a></h2>
