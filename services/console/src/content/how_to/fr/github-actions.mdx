---
title: "Actions GitHub"
description: "Utilisez Bencher dans les actions GitHub pour l'√©valuation continue des performances lors des demandes de tirage"
heading: "Comment utiliser Bencher dans les actions GitHub"
sortOrder: 3
---

import GitHubActions1 from "../../../chunks/how_to/github-actions.1.mdx";
import GitHubActions2 from "../../../chunks/how_to/github-actions.2.mdx";
import GitHubActions3 from "../../../chunks/how_to/github-actions.3.mdx";
import GitHubActions4 from "../../../chunks/how_to/github-actions.4.mdx";

<GitHubActions1 />

1. Cr√©ez une action GitHub `workflow` (par exemple : `.github/workflows/benchmark.yml`).
2. Sp√©cifiez les √©v√©nements sur lesquels le flux de travail doit s'ex√©cuter `on`. Consultez la [documentation des actions GitHub `on`](https://docs.github.com/fr/actions/using-workflows/workflow-syntax-for-github-actions#on) sur le sujet. Ce flux de travail est ex√©cut√© **uniquement** lors des √©v√©nements `push` sur la branche `main`. Pour ex√©cuter [sur les Pull Requests voir la section ci-dessous](#demandes-de-tirage).
3. Cr√©ez une `job` d'actions GitHub (par exemple : `benchmark_with_bencher`)
4. Le projet doit d√©j√† exister. D√©finissez l'indicateur `--project` ou la variable d'environnement `BENCHER_PROJECT` sur le slug ou l'UUID du projet. (par exemple : `BENCHER_PROJECT: save-walter-white`)
5. Ajoutez `BENCHER_API_TOKEN` √† vos secrets de **D√©p√¥t** (par exemple : `https://github.com/USERNAME/REPO/settings/secrets/actions`)
6. Le token API doit d√©j√† exister. D√©finissez l'indicateur `--token` ou la variable d'environnement `BENCHER_API_TOKEN` sur le token API. (par exemple : `BENCHER_API_TOKEN: ${{ secrets.BENCHER_API_TOKEN }}`)
7. Optionnel : D√©finir le drapeau `--adapter` ou la variable d'environnement `BENCHER_ADAPTER` sur le nom de l'adaptateur d√©sir√©. Si cela n'est pas d√©fini, alors l'adaptateur `magic` sera utilis√©. Consultez [adaptateurs de harnais d'√©valuation](/docs/fr/explanation/adapters) pour un aper√ßu complet. (par exemple : `BENCHER_ADAPTER: json`)
8. Optionnel : D√©finir le drapeau `--testbed` ou la variable d'environnement `BENCHER_TESTBED` sur le slug ou l'UUID du banc d'essai. Le banc d'essai **doit** d√©j√† exister. Si cela n'est pas d√©fini, alors le banc d'essai `localhost` sera utilis√©. (par ex.: `BENCHER_TESTBED: ubuntu-latest`)
9. R√©cup√©rez votre code source. (par exemple : `uses: actions/checkout@v3`)
10. Installez l'interface en ligne de commande Bencher en utilisant l'[Action GitHub](https://github.com/marketplace/actions/bencher-cli). (par exemple : `uses: bencherdev/bencher@main`)
11. [Suivez vos benchmarks](/docs/fr/how-to/track-benchmarks) avec la sous-commande CLI <code><a href="/docs/fr/explanation/bencher-run">bencher run</a></code> :
    1. Il existe plusieurs options pour d√©finir la branche du projet. Consultez [la s√©lection de la branche](/docs/fr/how-to/branch-selection) pour un aper√ßu complet. La commande fournie utilise les [variables d'environnement par d√©faut des actions GitHub](https://docs.github.com/fr/actions/learn-github-actions/variables#default-environment-variables) et essaie de :
        1. Utiliser les donn√©es de la branche actuelle si elles existent d√©j√†. (par exemple : `--if-branch "$GITHUB_REF_NAME"`)
        2. Cr√©er un clone des donn√©es de la branche cible de la PR et des seuils si ceux-ci existent d√©j√†. (par exemple : `--else-if-branch "$GITHUB_BASE_REF"`)
        3. Sinon, cr√©ez un clone des donn√©es de la branche `main` et des seuils. (par exemple : `--else-if-branch main`)
    2. R√©glez la commande pour qu'elle √©choue si une alerte est g√©n√©r√©e. Pour qu'une alerte soit g√©n√©r√©e, un [seuil](/docs/fr/explanation/thresholds) doit d√©j√† exister. (par exemple : `--err`)
    3. R√©glez le token d'authentification de l'API GitHub (par exemple : `--github-actions ${{ secrets.GITHUB_TOKEN }}`). Lorsque cette option est d√©finie dans le cadre d'une demande de tirage, les r√©sultats seront ajout√©s √† la demande de tirage sous forme de commentaire. La commande fournie utilise [la variable d'environnement `GITHUB_TOKEN` des actions GitHub](https://docs.github.com/fr/actions/security-guides/automatic-token-authentication).
    4. Ex√©cutez vos benchmarks et g√©n√©rez un rapport √† partir des r√©sultats. (par exemple : `"bencher mock"`)

<br/>

## Demandes de tirage

Pour d√©tecter les r√©gressions de performance dans les demandes de tirage, vous devrez ex√©cuter vos benchmarks sur les PRs.
Si vous ne pr√©voyez d'avoir que des PRs provenant de branches au sein du m√™me d√©p√¥t, vous pouvez simplement modifier l'exemple ci-dessus pour √©galement ex√©cuter `on` les √©v√©nements `pull_request`.

<GitHubActions2 />

Il est important de limiter l'ex√©cution `push` **uniquement** aux branches s√©lectionn√©es (par exemple : `main`)
pour √©viter que les pushes vers les branches de PR ne s'ex√©cutent deux fois !
Encore une fois, cette solution ne fonctionne que si toutes les PRs proviennent du **m√™me** d√©p√¥t.

Si vous pr√©voyez d'accepter des demandes de tirage provenant de forks, comme c'est souvent le cas dans les projets open source publics,
alors vous devrez g√©rer les choses un peu diff√©remment.
Pour des raisons de s√©curit√©, les secrets tels que votre `BENCHER_API_TOKEN` et le `GITHUB_TOKEN` ne sont pas disponibles dans les actions GitHub pour les PRs de fork.
C'est-√†-dire si un contributeur externe ouvre une PR √† partir d'un fork, l'exemple ci-dessus ne fonctionnera pas.
Il y a deux options pour les PRs de fork :

<ul>
  <li>[√âvaluer la branche de la PR √† partir de la branche cible](#evaluer-la-branche-pr-depuis-la-branche-cible)</li>
  <li>[Mettre en cache les r√©sultats des benchmarks de la branche PR et t√©l√©charger √† partir de la branche par d√©faut](#mettre-en-cache-les-resultats-de-benchmark-de-la-branche-pr)</li>
</ul>

### √âvaluer la branche PR depuis la branche cible

1. D√©clencher [sur l'√©v√©nement `pull_request_target`](https://docs.github.com/fr/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
2. Check-out de la branche PR.
3. Ex√©cutez et suivez vos benchmarks de PR en utilisant `bencher run` directement.

Cela fonctionne parce que `pull_request_target` s'ex√©cute dans le contexte de la branche cible de la demande de tirage,
o√π les secrets tels que votre `BENCHER_API_TOKEN` et le `GITHUB_TOKEN` sont disponibles.
Par cons√©quent, ce workflow ne s'ex√©cutera que s'il existe sur la branche cible.
√âvitez de d√©finir des secrets en tant que variables d'environnement, comme `BENCHER_API_TOKEN`.
Passez plut√¥t explicitement le token API √† `bencher run` (ex : `--token ${{ secrets.BENCHER_API_TOKEN }}`).
Voir cette [note sur le laboratoire de s√©curit√© de GitHub](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)
et [ce billet de blog](https://nathandavison.com/blog/github-actions-and-the-threat-of-malicious-pull-requests)
sur la pr√©vention des demandes de pwn pour un aper√ßu complet.

<GitHubActions3 />

### Mettre en cache les r√©sultats des benchmarks de la branche PR

1. Ex√©cutez vos benchmarks de PR lors des √©v√©nements `pull_request`.
1. Enregistrez les r√©sultats des benchmarks de la PR dans un fichier et t√©l√©chargez-les en tant qu'artefact.
1. T√©l√©chargez l'√©v√©nement PR en tant qu'artefact.
1. Cha√Ænez ce flux de travail avec [l'√©v√©nement `workflow_run`](https://docs.github.com/fr/actions/using-workflows/events-that-trigger-workflows#workflow_run).
1. Extrayez les donn√©es n√©cessaires de l'√©v√©nement PR mis en cache.
1. Suivez les r√©sultats des benchmarks de la PR en cache avec `bencher run`.

Cela fonctionne parce que `workflow_run` s'ex√©cute dans le contexte de la branche par d√©faut du d√©p√¥t,
o√π les secrets tels que votre `BENCHER_API_TOKEN` et le `GITHUB_TOKEN` sont disponibles.
Par cons√©quent, ces workflows ne s'ex√©cuteront que s'ils existent sur la branche par d√©faut.
Consultez [l'utilisation des donn√©es du workflow d√©clencheur](https://docs.github.com/fr/actions/using-workflows/events-that-trigger-workflows#using-data-from-the-triggering-workflow) pour un aper√ßu complet.
Le num√©ro de la demande de tirage, la branche t√™te et la branche base utilis√©s dans le workflow initial doivent √™tre explicitement transmis car ils ne sont pas disponibles dans `workflow_run`.

<GitHubActions4 />

<br/>
<br/>

> üê∞ F√©licitations ! Vous avez appris comment utiliser Bencher dans les Actions GitHub ! üéâ

<br/>

<h2><a href="/docs/fr/explanation/benchmarking">Continuer : Vue d'ensemble des benchmarks ‚û°</a></h2>