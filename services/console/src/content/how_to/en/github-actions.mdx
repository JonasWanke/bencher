---
title: "GitHub Actions"
description: "Use Bencher in GitHub Actions for continuous benchmarking on pull requests"
heading: "How to use Bencher in GitHub Actions"
sortOrder: 3
---

import GitHubActions1 from "../../../chunks/how_to/github-actions.1.mdx";
import GitHubActions2 from "../../../chunks/how_to/github-actions.2.mdx";
import GitHubActions3 from "../../../chunks/how_to/github-actions.3.mdx";
import GitHubActions4 from "../../../chunks/how_to/github-actions.4.mdx";

<GitHubActions1 />

1. Create a GitHub Actions `workflow` (ex: `.github/workflows/benchmark.yml`).
2. Specify events the workflow should run `on`. See the [GitHub Actions `on` documentation](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#on) for a full overview. This workflow runs **only** on `push` events to the `main` branch. For running [on Pull Requests see the section below](#pull-requests).
3. Create a GitHub Actions `job` (ex: `benchmark_with_bencher`)
4. The Project must already exist. Set the `--project` flag or the `BENCHER_PROJECT` environment variable to the Project slug or UUID. (ex: `BENCHER_PROJECT: save-walter-white`)
5. Add `BENCHER_API_TOKEN` as a **Repository** secret (ex: `Repo -> Settings -> Secrets and variables -> Actions -> New repository secret`)
6. The API token must already exist. Set the `--token` flag or the `BENCHER_API_TOKEN` environment variable to the API token. (ex: `BENCHER_API_TOKEN: ${{ secrets.BENCHER_API_TOKEN }}`)
7. Optional: Set the `--adapter` flag or the `BENCHER_ADAPTER` environment variable to the desired adapter name. If this is not set, then the `magic` Adapter will be used. See [benchmark harness adapters](/docs/explanation/adapters) for a full overview. (ex: `BENCHER_ADAPTER: json`)
8. Optional: Set the `--testbed` flag or the `BENCHER_TESTBED` environment variable to the Testbed slug or UUID. The Testbed **must** already exist. If this is not set, then the `localhost` Testbed will be used. (ex: `BENCHER_TESTBED: ubuntu-latest`)
9. Checkout your source code. (ex: `uses: actions/checkout@v3`)
10. Install the Bencher CLI using the [GitHub Action](https://github.com/marketplace/actions/bencher-cli). (ex: `uses: bencherdev/bencher@main`)
11. [Track your benchmarks](/docs/how-to/track-benchmarks) with the <code><a href="/docs/explanation/bencher-run">bencher run</a></code> CLI subcommand:
    1. There are several options for setting the project branch. See [branch selection](/docs/how-to/branch-selection) for a full overview. The provided command uses [GitHub Action default environment variables](https://docs.github.com/en/actions/learn-github-actions/variables#default-environment-variables) and it tries to:
        1. Use the current branch data if it already exists. (ex: `--if-branch "$GITHUB_REF_NAME"`)
        2. Create a clone of PR target branch data and thresholds if it already exists. (ex: `--else-if-branch "$GITHUB_BASE_REF"`)
        3. Otherwise, create a clone of the `main` branch data and thresholds. (ex: `--else-if-branch main`)
    2. Set the command to fail if an Alert is generated. In order for an Alert to be generated, a [Threshold](/docs/explanation/thresholds) must already exist. (ex: `--err`)
    3. Set the GitHub API authentication token (ex: `--github-actions ${{ secrets.GITHUB_TOKEN }}`). When this option is set as a part of a pull request, then the results will be added to the pull request as a comment. The provided command uses [the GitHub Actions `GITHUB_TOKEN` environment variable](https://docs.github.com/en/actions/security-guides/automatic-token-authentication).
    4. Run your benchmarks and generate a Report from the results. (ex: `"bencher mock"`)

<br/>

## Pull Requests

In order to catch performance regression in Pull Requests, you will need to run your benchmarks on PRs.
If you only expect to have PRs from branches within the same repository then you can simply modify the example above to also run `on` `pull_request` events.

<GitHubActions2 />

It is important to limit the run on `push` **only** to the select branches (ex: `main`)
to prevents pushes to PR branches from running twice!
Again, this solution only works if all PRs are from the **same** repository.

If you plan to accept Pull Requests from forks, as is often the case in public open source projects,
then you will need to handle things a little differently.
For security reasons, secrets such as your `BENCHER_API_TOKEN` and the `GITHUB_TOKEN` are not available in GitHub Actions for fork PRs.
That is if an external contributor opens up a PR from a fork the above example will not work.
There are two options for fork PRs:

<ul>
  <li>[Benchmark PR branch from the target branch](#benchmark-pr-branch-from-target-branch)</li>
  <li>[Cache PR branch benchmark results and upload from default branch](#cache-pr-benchmark-results)</li>
</ul>

### Benchmark PR Branch from Target Branch

1. Trigger [on the `pull_request_target` event](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
2. Checkout the PR branch.
3. Run and track your PR benchmarks using `bencher run` directly.

This works because `pull_request_target` runs in the context of the pull request's target branch,
where secrets such as your `BENCHER_API_TOKEN` and the `GITHUB_TOKEN` are available.
Therefore, this workflow will only run if it exists on the target branch.
Avoid setting any secrets as environment variables, such as `BENCHER_API_TOKEN`.
Instead explicitly pass in the API token to `bencher run` (ex: `--token ${{ secrets.BENCHER_API_TOKEN }}`).
See this [GitHub Security Lab write up](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)
and [this blog post](https://nathandavison.com/blog/github-actions-and-the-threat-of-malicious-pull-requests)
on preventing pwn requests for a full overview.

<GitHubActions3 />

### Cache PR Benchmark Results

1. Run your PR benchmarks on `pull_request` events.
1. Save the PR benchmarks results to a file and upload them as an artifact.
1. Upload the PR event as an artifact.
1. Chain that workflow with [the `workflow_run` event](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_run).
1. Extract necessary data from the cached PR event.
1. Track the cached PR benchmark results with `bencher run`.

This works because `workflow_run` runs in the context of the repository's default branch,
where secrets such as your `BENCHER_API_TOKEN` and the `GITHUB_TOKEN` are available.
Therefore, these workflows will only run if they exist on the default branch.
See [using data from the triggering workflow](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#using-data-from-the-triggering-workflow) for a full overview.
The pull request number, head branch, and base branch used in the initial workflow must be explicitly passed in since they are not available within `workflow_run`.

<GitHubActions4 />

<br/>
<br/>

> üê∞ Congrats! You have learned how to use Bencher in GitHub Actions! üéâ

<br/>

<h2><a href="/docs/explanation/benchmarking">Keep Going: Benchmarking Overview ‚û°</a></h2>
